(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5],{5778:(e,s,t)=>{Promise.resolve().then(t.bind(t,8468))},8468:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>w});var r=t(1215),i=t(5591),a=t(4283),o=t(2512),l=t.n(o),n=t(9724),c=t(3748),d=t(4465),m=t(287),h=t(5361),u=t(8144);function p(e){let{product:s,onSuccess:t,onError:a}=e,[o,l]=(0,i.useState)(!1),{shippingAddress:n,discountEmail:c}=(0,h._)(),d=async()=>{l(!0);try{var e;console.log("Creating order with data:",{items:[{name:s.name,price:s.price,quantity:1,description:s.description}],total:s.price,currency:"GBP",customer_email:c,shipping_address:n});let r=await fetch("/api/create-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:[{name:s.name,price:s.price,quantity:1,description:s.description}],total:s.price,currency:"GBP",customer_email:c,shipping_address:n})}),i=await r.json();if(console.log("Order created successfully:",i),!r.ok)throw Error(i.error||"Failed to create order");let a=await fetch("/api/create-charge",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:s.name,description:s.description,local_price:{amount:s.price.toString(),currency:"GBP"},pricing_type:"fixed_price",metadata:{order_id:i.id},redirect_url:"".concat(window.location.origin,"/checkout/success"),cancel_url:"".concat(window.location.origin,"/products")})}),o=await a.json();if(console.log("Coinbase charge created:",o),!a.ok)throw Error(o.error||"Failed to create charge");let l=(null===(e=o.data)||void 0===e?void 0:e.hosted_url)||o.hosted_url;if(l)window.location.href=l;else throw Error("No hosted URL in response");t&&t()}catch(s){console.error("Checkout error:",s);let e=s instanceof Error?s.message:"Failed to process payment";u.oR.error(e),a&&a(s)}finally{l(!1)}};return(0,r.jsx)(m.$,{onClick:d,className:"w-full bg-moss-500 hover:bg-moss-600",disabled:o,children:o?"Processing...":"Pay with Crypto"})}let x=a.default,g=l(),y=m.$,f=n.A,j=c.A,b=d.A;function w(){let{cart:e,updateQuantity:s,removeFromCart:t,discountEmail:a,discount:o,applyDiscount:l,shippingAddress:n,setShippingAddress:c,clearCart:d}=(0,h._)();console.log("Cart data in page:",e);let[m,w]=(0,i.useState)(!1);if(0===e.length)return(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"Your Cart"}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-8",children:[(0,r.jsx)("p",{className:"text-lg text-gray-600",children:"Your cart is empty"}),(0,r.jsx)(y,{className:"mt-4 bg-moss-500 hover:bg-moss-600",onClick:()=>window.location.href="/products",children:"Continue Shopping"})]})})]});let N=e.reduce((e,s)=>e+s.price*s.quantity,0),v=N>75?0:5.99,k=o?(N+v)*.1:0,_=Math.max(0,N+v-k),C=e.map(e=>"".concat(e.name," x").concat(e.quantity)).join(", "),S=e=>e.map(e=>({title:e.name,sku:"CBD-".concat(e.id),quantity:e.quantity,total_price:(e.price*e.quantity).toFixed(2),currency:"GBP",weight:"1",weight_unit:"kg"})),F=async()=>{try{let s={to_address:{name:n.name,company:n.company,street1:n.street1,street2:n.street2,city:n.city,state:n.state,zip:n.zip,country:n.country,phone:n.phone,email:n.email,is_residential:!0},line_items:S(e),placed_at:new Date().toISOString(),order_number:"CBD-".concat(Date.now()),order_status:"PAID",shipping_cost:v.toString(),shipping_cost_currency:"GBP",shipping_method:"Hermes UK ParcelShop Drop-Off",subtotal_price:N.toFixed(2),total_price:_.toFixed(2),total_tax:"0.00",currency:"GBP",weight:"1",weight_unit:"kg"},t=await fetch("/api/shippo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderData:s,shippingAddress:n,items:e})}),r=await t.json();if(!t.ok)throw Error(r.error||"Failed to create order");return r}catch(e){throw console.error("Error creating order:",e),e}};return(0,r.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"Your Cart"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,r.jsx)("div",{className:"lg:col-span-2",children:(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,r.jsx)("div",{className:"flow-root",children:(0,r.jsx)("ul",{className:"divide-y divide-gray-200",children:e.map(e=>(0,r.jsxs)("li",{className:"py-6 flex",children:[(0,r.jsx)("div",{className:"relative h-24 w-24 rounded-md overflow-hidden flex-shrink-0",children:(0,r.jsx)(x,{src:e.image||"/placeholder.svg",alt:e.name,fill:!0,className:"object-cover"})}),(0,r.jsxs)("div",{className:"ml-4 flex-1 flex flex-col",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between text-base font-medium text-gray-900",children:[(0,r.jsx)("h3",{children:(0,r.jsx)(g,{href:"/products/".concat(e.id),className:"hover:text-green-600",children:e.name})}),(0,r.jsxs)("p",{className:"ml-4",children:["\xa3",(e.price*e.quantity).toFixed(2)]})]}),e.selectedStrength&&(0,r.jsxs)("p",{className:"mt-1 text-sm text-gray-500",children:["Strength: ",e.selectedStrength]})]}),(0,r.jsxs)("div",{className:"flex-1 flex items-end justify-between text-sm",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(y,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>s(e.id,Math.max(1,e.quantity-1)),children:(0,r.jsx)(f,{className:"h-3 w-3"})}),(0,r.jsx)("span",{className:"w-8 text-center",children:e.quantity}),(0,r.jsx)(y,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>s(e.id,e.quantity+1),children:(0,r.jsx)(j,{className:"h-3 w-3"})})]}),(0,r.jsx)(y,{variant:"ghost",size:"sm",className:"text-red-500 hover:text-red-600",onClick:()=>t(e.id),children:(0,r.jsx)(b,{className:"h-4 w-4"})})]})]})]},e.id))})})})}),(0,r.jsx)("div",{className:"lg:col-span-1",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Order Summary"}),(0,r.jsx)("div",{className:"flow-root",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("p",{className:"text-gray-600",children:"Subtotal"}),(0,r.jsxs)("p",{className:"font-medium",children:["\xa3",N.toFixed(2)]})]}),o&&k>0&&(0,r.jsxs)("div",{className:"flex justify-between text-green-600",children:[(0,r.jsxs)("p",{children:["Discount (",o.code,") - 10% off"]}),(0,r.jsxs)("p",{children:["-\xa3",k.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("p",{className:"text-gray-600",children:"Shipping"}),(0,r.jsx)("p",{className:"font-medium",children:0===v?"Free":"\xa3".concat(v.toFixed(2))})]}),(0,r.jsx)("div",{className:"border-t border-gray-200 pt-4",children:(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("p",{className:"text-gray-900 font-medium",children:"Total"}),(0,r.jsxs)("p",{className:"text-gray-900 font-bold",children:["\xa3",_.toFixed(2)]})]})})]})}),(0,r.jsxs)("div",{className:"mt-6 border-t pt-6",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Shipping Address"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"shipping-name",className:"block text-sm font-medium text-gray-700",children:"Full Name *"}),(0,r.jsx)("input",{type:"text",id:"shipping-name",value:n.name,onChange:e=>c(s=>({...s,name:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-moss-500 focus:ring-moss-500 sm:text-sm",required:!0})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"shipping-email",className:"block text-sm font-medium text-gray-700",children:"Email Address *"}),(0,r.jsx)("input",{type:"email",id:"shipping-email",value:n.email,onChange:e=>c(s=>({...s,email:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-moss-500 focus:ring-moss-500 sm:text-sm",required:!0,placeholder:"your@email.com"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"shipping-phone",className:"block text-sm font-medium text-gray-700",children:"Phone Number *"}),(0,r.jsx)("input",{type:"tel",id:"shipping-phone",value:n.phone,onChange:e=>c(s=>({...s,phone:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-moss-500 focus:ring-moss-500 sm:text-sm",required:!0,placeholder:"07123456789"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"shipping-street1",className:"block text-sm font-medium text-gray-700",children:"Address Line 1 *"}),(0,r.jsx)("input",{type:"text",id:"shipping-street1",value:n.street1,onChange:e=>c(s=>({...s,street1:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-moss-500 focus:ring-moss-500 sm:text-sm",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"shipping-street2",className:"block text-sm font-medium text-gray-700",children:"Address Line 2"}),(0,r.jsx)("input",{type:"text",id:"shipping-street2",value:n.street2,onChange:e=>c(s=>({...s,street2:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-moss-500 focus:ring-moss-500 sm:text-sm"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"shipping-city",className:"block text-sm font-medium text-gray-700",children:"City *"}),(0,r.jsx)("input",{type:"text",id:"shipping-city",value:n.city,onChange:e=>c(s=>({...s,city:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-moss-500 focus:ring-moss-500 sm:text-sm",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"shipping-state",className:"block text-sm font-medium text-gray-700",children:"County *"}),(0,r.jsx)("input",{type:"text",id:"shipping-state",value:n.state,onChange:e=>c(s=>({...s,state:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-moss-500 focus:ring-moss-500 sm:text-sm",required:!0,placeholder:"e.g. Greater London"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"shipping-zip",className:"block text-sm font-medium text-gray-700",children:"Postcode *"}),(0,r.jsx)("input",{type:"text",id:"shipping-zip",value:n.zip,onChange:e=>c(s=>({...s,zip:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-moss-500 focus:ring-moss-500 sm:text-sm",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"shipping-country",className:"block text-sm font-medium text-gray-700",children:"Country *"}),(0,r.jsx)("select",{id:"shipping-country",value:n.country,onChange:e=>c(s=>({...s,country:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-moss-500 focus:ring-moss-500 sm:text-sm",required:!0,children:(0,r.jsx)("option",{value:"United Kingdom",children:"United Kingdom"})})]})]}),"United Kingdom"!==n.country&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:"Currently, we only ship to addresses within the United Kingdom."})]})]}),(0,r.jsx)("div",{className:"mt-6",children:(0,r.jsx)(p,{product:{name:"Cart Purchase",price:_,description:C},onSuccess:async()=>{try{var e,s;if("United Kingdom"!==n.country){u.oR.error("We currently only ship to UK addresses");return}if(!n.street1||!n.city||!n.zip||!n.email){u.oR.error("Please fill in all required shipping address fields");return}let t=await F(),r=await fetch("/api/mailerlite",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n.email,name:n.street1.split(" ")[0],tracking_number:t.tracking_number,tracking_url:t.tracking_url,order_id:t.order_id})}),i=await r.json();r.ok||console.error("MailerLite error:",i);let a=(null===(e=t.selectedRate)||void 0===e?void 0:e.amount)||"0";u.oR.success("Payment successful! Shipping label created with ".concat(null===(s=t.selectedRate)||void 0===s?void 0:s.provider," (").concat(a," GBP)")),d()}catch(e){console.error("Error processing order:",e),u.oR.error("Payment successful but failed to process order")}},onError:e=>{u.oR.error(e.message||"Payment failed")}})})]})})]})]})}},8475:(e,s,t)=>{"use strict";t.d(s,{A:()=>n});var r=t(5591);let i=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),a=function(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return s.filter((e,s,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===s).join(" ").trim()};var o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,r.forwardRef)((e,s)=>{let{color:t="currentColor",size:i=24,strokeWidth:l=2,absoluteStrokeWidth:n,className:c="",children:d,iconNode:m,...h}=e;return(0,r.createElement)("svg",{ref:s,...o,width:i,height:i,stroke:t,strokeWidth:n?24*Number(l)/Number(i):l,className:a("lucide",c),...h},[...m.map(e=>{let[s,t]=e;return(0,r.createElement)(s,t)}),...Array.isArray(d)?d:[d]])}),n=(e,s)=>{let t=(0,r.forwardRef)((t,o)=>{let{className:n,...c}=t;return(0,r.createElement)(l,{ref:o,iconNode:s,className:a("lucide-".concat(i(e)),n),...c})});return t.displayName="".concat(e),t}}},e=>{var s=s=>e(e.s=s);e.O(0,[512,638,265,520,361,784,255,358],()=>s(5778)),_N_E=e.O()}]);