"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[361],{287:(e,t,s)=>{s.d(t,{$:()=>o});var a=s(1215),r=s(5591),l=s(4851),i=s(3736),n=s(411);let d=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=r.forwardRef((e,t)=>{let{className:s,variant:r,size:i,asChild:o=!1,...c}=e,u=o?l.DX:"button";return(0,a.jsx)(u,{className:(0,n.cn)(d({variant:r,size:i,className:s})),ref:t,...c})});o.displayName="Button"},411:(e,t,s)=>{s.d(t,{cn:()=>l});var a=s(4262),r=s(2065);function l(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.QP)((0,a.$)(t))}},5361:(e,t,s)=>{s.d(t,{_:()=>u,default:()=>m});var a=s(1215),r=s(5591);s(287);var l=s(7435),i=s(916);let n=l.A,d=i.A,o=(0,r.createContext)(void 0),c=o.Provider;function u(){let e=(0,r.useContext)(o);if(void 0===e)throw Error("useCart must be used within a CartProvider");return e}function m(e){let{children:t}=e,[s,l]=(0,r.useState)([]),[i,o]=(0,r.useState)(!1),[u,m]=(0,r.useState)(null),[x,h]=(0,r.useState)({line1:"",line2:"",city:"",postal_code:"",country:"United Kingdom",email:""}),[g,f]=(0,r.useState)(""),[y,p]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(!y){let e=localStorage.getItem("cart"),t=localStorage.getItem("discount");e&&l(JSON.parse(e)),t&&m(JSON.parse(t)),p(!0)}},[y]),(0,r.useEffect)(()=>{y&&localStorage.setItem("cart",JSON.stringify(s))},[s,y]),(0,r.useEffect)(()=>{y&&localStorage.setItem("discount",JSON.stringify(u))},[u,y]),console.log("CartProvider state:",{cart:s,isOpen:i,discount:u});let v=e=>{l(t=>{let s=t.filter(t=>t.id!==e);return console.log("Cart after removing item:",s),s})},j=(e,t)=>{l(s=>{let a=s.map(s=>s.id===e?{...s,quantity:t}:s);return console.log("Cart after updating quantity:",a),a})},b=async(e,t)=>{try{let s=await fetch("/api/validate-discount",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e,email:t})}),a=await s.json();if(!a.valid)return{success:!1,message:a.message};let r=await fetch("/api/mark-discount-used",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e,email:t})});if(!(await r.json()).success)return{success:!1,message:"Failed to apply discount code"};return m({type:a.discount.discount_type,value:a.discount.discount_value,code:a.discount.code}),{success:!0,message:"Discount code applied successfully!"}}catch(e){return console.error("Error applying discount:",e),{success:!1,message:"Failed to apply discount code"}}},N=s.reduce((e,t)=>e+t.price*t.quantity,0),w=N>75?0:5.99,S=u?"percentage"===u.type?N*u.value/100:u.value:0,C=N+w-S;return(0,a.jsxs)(c,{value:{cart:s,addToCart:e=>{console.log("Adding to cart:",e),l(t=>{let s=t.findIndex(t=>t.id===e.id&&(t.selectedStrength===e.selectedStrength||!t.selectedStrength&&!e.selectedStrength));if(-1!==s){let a=[...t];return a[s].quantity+=e.quantity,console.log("Updated cart after adding:",a),a}{let s=[...t,e];return console.log("New cart after adding:",s),s}})},removeFromCart:v,updateQuantity:j,clearCart:()=>{l([]),m(null),y&&(localStorage.removeItem("cart"),localStorage.removeItem("discount"))},isOpen:i,setIsOpen:o,discount:u,setDiscount:m,applyDiscount:b,shippingAddress:x,setShippingAddress:h,discountEmail:g,setDiscountEmail:f},children:[t,i&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 overflow-hidden",children:(0,a.jsx)("div",{className:"absolute inset-0 overflow-hidden",children:(0,a.jsx)("div",{className:"pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-10",children:(0,a.jsx)("div",{className:"pointer-events-auto w-screen max-w-md",children:(0,a.jsxs)("div",{className:"flex h-full flex-col overflow-y-scroll bg-white shadow-xl",children:[(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto px-4 py-6 sm:px-6",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Your Cart"}),(0,a.jsx)("div",{className:"ml-3 flex h-7 items-center",children:(0,a.jsxs)("button",{type:"button",className:"relative -m-2 p-2 text-gray-400 hover:text-gray-500",onClick:()=>o(!1),children:[(0,a.jsx)("span",{className:"absolute -inset-0.5"}),(0,a.jsx)("span",{className:"sr-only",children:"Close panel"}),(0,a.jsx)(d,{className:"h-6 w-6","aria-hidden":"true"})]})})]}),(0,a.jsx)("div",{className:"mt-8",children:0===s.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-8",children:[(0,a.jsx)(n,{className:"h-12 w-12 text-gray-400 mb-4"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Your cart is empty"})]}):(0,a.jsx)("div",{className:"flow-root",children:(0,a.jsx)("ul",{className:"-my-6 divide-y divide-gray-200",children:s.map(e=>(0,a.jsxs)("li",{className:"flex py-6",children:[(0,a.jsx)("div",{className:"h-24 w-24 flex-shrink-0 overflow-hidden rounded-md border border-gray-200",children:(0,a.jsx)("img",{src:e.image,alt:e.name,className:"h-full w-full object-cover object-center"})}),(0,a.jsxs)("div",{className:"ml-4 flex flex-1 flex-col",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between text-base font-medium text-gray-900",children:[(0,a.jsx)("h3",{children:e.name}),(0,a.jsxs)("p",{className:"ml-4",children:["\xa3",(e.price*e.quantity).toFixed(2)]})]}),e.selectedStrength&&(0,a.jsxs)("p",{className:"mt-1 text-sm text-gray-500",children:["Strength: ",e.selectedStrength]})]}),(0,a.jsxs)("div",{className:"flex flex-1 items-end justify-between text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("button",{onClick:()=>j(e.id,Math.max(1,e.quantity-1)),className:"text-gray-500 hover:text-gray-700",children:"-"}),(0,a.jsx)("span",{className:"mx-2",children:e.quantity}),(0,a.jsx)("button",{onClick:()=>j(e.id,e.quantity+1),className:"text-gray-500 hover:text-gray-700",children:"+"})]}),(0,a.jsx)("button",{type:"button",onClick:()=>v(e.id),className:"font-medium text-red-600 hover:text-red-500",children:"Remove"})]})]})]},e.id))})})})]}),(0,a.jsxs)("div",{className:"border-t border-gray-200 px-4 py-6 sm:px-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Shipping Address"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"line1",className:"block text-sm font-medium text-gray-700",children:"Address Line 1 *"}),(0,a.jsx)("input",{type:"text",id:"line1",value:x.line1,onChange:e=>h(t=>({...t,line1:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-moss-500 focus:ring-moss-500 sm:text-sm",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"line2",className:"block text-sm font-medium text-gray-700",children:"Address Line 2"}),(0,a.jsx)("input",{type:"text",id:"line2",value:x.line2,onChange:e=>h(t=>({...t,line2:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-moss-500 focus:ring-moss-500 sm:text-sm"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"city",className:"block text-sm font-medium text-gray-700",children:"City *"}),(0,a.jsx)("input",{type:"text",id:"city",value:x.city,onChange:e=>h(t=>({...t,city:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-moss-500 focus:ring-moss-500 sm:text-sm",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"postal_code",className:"block text-sm font-medium text-gray-700",children:"Postal Code *"}),(0,a.jsx)("input",{type:"text",id:"postal_code",value:x.postal_code,onChange:e=>h(t=>({...t,postal_code:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-moss-500 focus:ring-moss-500 sm:text-sm",required:!0})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"country",className:"block text-sm font-medium text-gray-700",children:"Country *"}),(0,a.jsxs)("select",{id:"country",value:x.country,onChange:e=>h(t=>({...t,country:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-moss-500 focus:ring-moss-500 sm:text-sm",required:!0,children:[(0,a.jsx)("option",{value:"United Kingdom",children:"United Kingdom"}),(0,a.jsx)("option",{value:"United States",children:"United States"}),(0,a.jsx)("option",{value:"Canada",children:"Canada"}),(0,a.jsx)("option",{value:"Australia",children:"Australia"}),(0,a.jsx)("option",{value:"Germany",children:"Germany"}),(0,a.jsx)("option",{value:"France",children:"France"}),(0,a.jsx)("option",{value:"Spain",children:"Spain"}),(0,a.jsx)("option",{value:"Italy",children:"Italy"})]})]})]})]}),(0,a.jsx)("div",{className:"border-t border-gray-200 px-4 py-6 sm:px-6",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between text-base text-gray-900",children:[(0,a.jsx)("p",{children:"Subtotal"}),(0,a.jsxs)("p",{children:["\xa3",N.toFixed(2)]})]}),u&&(0,a.jsxs)("div",{className:"flex justify-between text-base text-green-600",children:[(0,a.jsxs)("p",{children:["Discount (",u.code,")"]}),(0,a.jsxs)("p",{children:["-\xa3",S.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-base text-gray-900",children:[(0,a.jsx)("p",{children:"Shipping"}),(0,a.jsx)("p",{children:0===w?"Free":"\xa3".concat(w.toFixed(2))})]}),(0,a.jsxs)("div",{className:"flex justify-between text-base font-medium text-gray-900",children:[(0,a.jsx)("p",{children:"Total"}),(0,a.jsxs)("p",{children:["\xa3",C.toFixed(2)]})]})]})})]})})})})})]})}}}]);