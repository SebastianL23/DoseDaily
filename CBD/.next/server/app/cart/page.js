(()=>{var e={};e.id=5,e.ids=[5],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9984:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>o.a,__next_app__:()=>m,pages:()=>c,routeModule:()=>p,tree:()=>d});var r=t(38343),i=t(44360),a=t(43642),o=t.n(a),n=t(83357),l={};for(let e in n)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);t.d(s,l);let d={children:["",{children:["cart",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,17026)),"/Users/sebastianlourenco/Desktop/CBD/CBD/app/cart/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,55942)),"/Users/sebastianlourenco/Desktop/CBD/CBD/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,99558,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,97375,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,33812,23)),"next/dist/client/components/unauthorized-error"]}]}.children,c=["/Users/sebastianlourenco/Desktop/CBD/CBD/app/cart/page.tsx"],m={require:t,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:i.RouteKind.APP_PAGE,page:"/cart/page",pathname:"/cart",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},17026:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});let r=(0,t(53115).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/sebastianlourenco/Desktop/CBD/CBD/app/cart/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/sebastianlourenco/Desktop/CBD/CBD/app/cart/page.tsx","default")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},27910:e=>{"use strict";e.exports=require("stream")},28575:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>v});var r=t(23639),i=t(93602),a=t(71202),o=t(99166),n=t.n(o),l=t(26694),d=t(84244),c=t(67847),m=t(73498),p=t(81619),u=t(68582);function h({product:e,onSuccess:s,onError:t}){let[a,o]=(0,i.useState)(!1),{shippingAddress:n,discountEmail:l}=(0,p._)(),d=async()=>{o(!0);try{console.log("Creating order with data:",{items:[{name:e.name,price:e.price,quantity:1,description:e.description}],total:e.price,currency:"GBP",customer_email:l,shipping_address:n});let t=await fetch("/api/create-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:[{name:e.name,price:e.price,quantity:1,description:e.description}],total:e.price,currency:"GBP",customer_email:l,shipping_address:n})}),r=await t.json();if(console.log("Order created successfully:",r),!t.ok)throw Error(r.error||"Failed to create order");let i=await fetch("/api/create-charge",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e.name,description:e.description,local_price:{amount:e.price.toString(),currency:"GBP"},pricing_type:"fixed_price",metadata:{order_id:r.id},redirect_url:`${window.location.origin}/checkout/success`,cancel_url:`${window.location.origin}/products`})}),a=await i.json();if(console.log("Coinbase charge created:",a),!i.ok)throw Error(a.error||"Failed to create charge");let o=a.data?.hosted_url||a.hosted_url;if(o)window.location.href=o;else throw Error("No hosted URL in response");s&&s()}catch(s){console.error("Checkout error:",s);let e=s instanceof Error?s.message:"Failed to process payment";u.oR.error(e),t&&t(s)}finally{o(!1)}};return(0,r.jsx)(m.$,{onClick:d,className:"w-full bg-moss-500 hover:bg-moss-600",disabled:a,children:a?"Processing...":"Pay with Crypto"})}let x=a.default,g=n(),y=m.$,f=l.A,j=d.A,b=c.A;function v(){let{cart:e,updateQuantity:s,removeFromCart:t,discountEmail:a,discount:o,applyDiscount:n,shippingAddress:l,setShippingAddress:d,clearCart:c}=(0,p._)();console.log("Cart data in page:",e);let[m,v]=(0,i.useState)(!1);if(0===e.length)return(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"Your Cart"}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-8",children:[(0,r.jsx)("p",{className:"text-lg text-gray-600",children:"Your cart is empty"}),(0,r.jsx)(y,{className:"mt-4 bg-moss-500 hover:bg-moss-600",onClick:()=>window.location.href="/products",children:"Continue Shopping"})]})})]});let w=e.reduce((e,s)=>e+s.price*s.quantity,0),N=w>75?0:5.99,_=o?(w+N)*.1:0,k=Math.max(0,w+N-_),C=e.map(e=>`${e.name} x${e.quantity}`).join(", "),q=e=>e.map(e=>({title:e.name,sku:`CBD-${e.id}`,quantity:e.quantity,total_price:(e.price*e.quantity).toFixed(2),currency:"GBP",weight:"1",weight_unit:"kg"})),P=async()=>{try{let s={to_address:{name:l.name,company:l.company,street1:l.street1,street2:l.street2,city:l.city,state:l.state,zip:l.zip,country:l.country,phone:l.phone,email:l.email,is_residential:!0},line_items:q(e),placed_at:new Date().toISOString(),order_number:`CBD-${Date.now()}`,order_status:"PAID",shipping_cost:N.toString(),shipping_cost_currency:"GBP",shipping_method:"Hermes UK ParcelShop Drop-Off",subtotal_price:w.toFixed(2),total_price:k.toFixed(2),total_tax:"0.00",currency:"GBP",weight:"1",weight_unit:"kg"},t=await fetch("/api/shippo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderData:s,shippingAddress:l,items:e})}),r=await t.json();if(!t.ok)throw Error(r.error||"Failed to create order");return r}catch(e){throw console.error("Error creating order:",e),e}};return(0,r.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"Your Cart"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,r.jsx)("div",{className:"lg:col-span-2",children:(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,r.jsx)("div",{className:"flow-root",children:(0,r.jsx)("ul",{className:"divide-y divide-gray-200",children:e.map(e=>(0,r.jsxs)("li",{className:"py-6 flex",children:[(0,r.jsx)("div",{className:"relative h-24 w-24 rounded-md overflow-hidden flex-shrink-0",children:(0,r.jsx)(x,{src:e.image||"/placeholder.svg",alt:e.name,fill:!0,className:"object-cover"})}),(0,r.jsxs)("div",{className:"ml-4 flex-1 flex flex-col",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between text-base font-medium text-gray-900",children:[(0,r.jsx)("h3",{children:(0,r.jsx)(g,{href:`/products/${e.id}`,className:"hover:text-green-600",children:e.name})}),(0,r.jsxs)("p",{className:"ml-4",children:["\xa3",(e.price*e.quantity).toFixed(2)]})]}),e.selectedStrength&&(0,r.jsxs)("p",{className:"mt-1 text-sm text-gray-500",children:["Strength: ",e.selectedStrength]})]}),(0,r.jsxs)("div",{className:"flex-1 flex items-end justify-between text-sm",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(y,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>s(e.id,Math.max(1,e.quantity-1)),children:(0,r.jsx)(f,{className:"h-3 w-3"})}),(0,r.jsx)("span",{className:"w-8 text-center",children:e.quantity}),(0,r.jsx)(y,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>s(e.id,e.quantity+1),children:(0,r.jsx)(j,{className:"h-3 w-3"})})]}),(0,r.jsx)(y,{variant:"ghost",size:"sm",className:"text-red-500 hover:text-red-600",onClick:()=>t(e.id),children:(0,r.jsx)(b,{className:"h-4 w-4"})})]})]})]},e.id))})})})}),(0,r.jsx)("div",{className:"lg:col-span-1",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Order Summary"}),(0,r.jsx)("div",{className:"flow-root",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("p",{className:"text-gray-600",children:"Subtotal"}),(0,r.jsxs)("p",{className:"font-medium",children:["\xa3",w.toFixed(2)]})]}),o&&_>0&&(0,r.jsxs)("div",{className:"flex justify-between text-green-600",children:[(0,r.jsxs)("p",{children:["Discount (",o.code,") - 10% off"]}),(0,r.jsxs)("p",{children:["-\xa3",_.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("p",{className:"text-gray-600",children:"Shipping"}),(0,r.jsx)("p",{className:"font-medium",children:0===N?"Free":`\xa3${N.toFixed(2)}`})]}),(0,r.jsx)("div",{className:"border-t border-gray-200 pt-4",children:(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("p",{className:"text-gray-900 font-medium",children:"Total"}),(0,r.jsxs)("p",{className:"text-gray-900 font-bold",children:["\xa3",k.toFixed(2)]})]})})]})}),(0,r.jsxs)("div",{className:"mt-6 border-t pt-6",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Shipping Address"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"shipping-name",className:"block text-sm font-medium text-gray-700",children:"Full Name *"}),(0,r.jsx)("input",{type:"text",id:"shipping-name",value:l.name,onChange:e=>d(s=>({...s,name:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-moss-500 focus:ring-moss-500 sm:text-sm",required:!0})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"shipping-email",className:"block text-sm font-medium text-gray-700",children:"Email Address *"}),(0,r.jsx)("input",{type:"email",id:"shipping-email",value:l.email,onChange:e=>d(s=>({...s,email:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-moss-500 focus:ring-moss-500 sm:text-sm",required:!0,placeholder:"your@email.com"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"shipping-phone",className:"block text-sm font-medium text-gray-700",children:"Phone Number *"}),(0,r.jsx)("input",{type:"tel",id:"shipping-phone",value:l.phone,onChange:e=>d(s=>({...s,phone:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-moss-500 focus:ring-moss-500 sm:text-sm",required:!0,placeholder:"07123456789"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"shipping-street1",className:"block text-sm font-medium text-gray-700",children:"Address Line 1 *"}),(0,r.jsx)("input",{type:"text",id:"shipping-street1",value:l.street1,onChange:e=>d(s=>({...s,street1:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-moss-500 focus:ring-moss-500 sm:text-sm",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"shipping-street2",className:"block text-sm font-medium text-gray-700",children:"Address Line 2"}),(0,r.jsx)("input",{type:"text",id:"shipping-street2",value:l.street2,onChange:e=>d(s=>({...s,street2:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-moss-500 focus:ring-moss-500 sm:text-sm"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"shipping-city",className:"block text-sm font-medium text-gray-700",children:"City *"}),(0,r.jsx)("input",{type:"text",id:"shipping-city",value:l.city,onChange:e=>d(s=>({...s,city:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-moss-500 focus:ring-moss-500 sm:text-sm",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"shipping-state",className:"block text-sm font-medium text-gray-700",children:"County *"}),(0,r.jsx)("input",{type:"text",id:"shipping-state",value:l.state,onChange:e=>d(s=>({...s,state:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-moss-500 focus:ring-moss-500 sm:text-sm",required:!0,placeholder:"e.g. Greater London"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"shipping-zip",className:"block text-sm font-medium text-gray-700",children:"Postcode *"}),(0,r.jsx)("input",{type:"text",id:"shipping-zip",value:l.zip,onChange:e=>d(s=>({...s,zip:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-moss-500 focus:ring-moss-500 sm:text-sm",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"shipping-country",className:"block text-sm font-medium text-gray-700",children:"Country *"}),(0,r.jsx)("select",{id:"shipping-country",value:l.country,onChange:e=>d(s=>({...s,country:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-moss-500 focus:ring-moss-500 sm:text-sm",required:!0,children:(0,r.jsx)("option",{value:"United Kingdom",children:"United Kingdom"})})]})]}),"United Kingdom"!==l.country&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:"Currently, we only ship to addresses within the United Kingdom."})]})]}),(0,r.jsx)("div",{className:"mt-6",children:(0,r.jsx)(h,{product:{name:"Cart Purchase",price:k,description:C},onSuccess:async()=>{try{if("United Kingdom"!==l.country){u.oR.error("We currently only ship to UK addresses");return}if(!l.street1||!l.city||!l.zip||!l.email){u.oR.error("Please fill in all required shipping address fields");return}let e=await P(),s=await fetch("/api/mailerlite",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:l.email,name:l.street1.split(" ")[0],tracking_number:e.tracking_number,tracking_url:e.tracking_url,order_id:e.order_id})}),t=await s.json();s.ok||console.error("MailerLite error:",t);let r=e.selectedRate?.amount||"0";u.oR.success(`Payment successful! Shipping label created with ${e.selectedRate?.provider} (${r} GBP)`),c()}catch(e){console.error("Error processing order:",e),u.oR.error("Payment successful but failed to process order")}},onError:e=>{u.oR.error(e.message||"Payment failed")}})})]})})]})]})}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33022:(e,s,t)=>{Promise.resolve().then(t.bind(t,17026))},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73190:(e,s,t)=>{Promise.resolve().then(t.bind(t,28575))},74075:e=>{"use strict";e.exports=require("zlib")},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")}};var s=require("../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[535,129,462],()=>t(9984));module.exports=r})();