(()=>{var e={};e.id=767,e.ids=[767],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},24467:()=>{},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},61419:()=>{},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},89823:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>m,routeModule:()=>u,serverHooks:()=>h,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{POST:()=>l});var a=r(43007),o=r(44360),n=r(98343),i=r(28142);let c=process.env.SHIPPO_API_TOKEN,p="https://api.goshippo.com";async function l(e){try{if(!c)throw Error("SHIPPO_API_TOKEN is not configured");let{shippingAddress:t,items:r}=await e.json();if(!t||!r)throw Error("Missing required shipping address or items data");let s={name:"Dose Daily",company:"Dose Daily",street1:"36 Woodacre",city:"Bristol",state:"avon",zip:"BS207BT",country:"United Kingdom",phone:"077990266704",email:"your@email.com",is_residential:!1},a={name:t.name||"Customer",street1:t.line1,street2:t.line2||"",city:t.city,state:t.state||"",zip:t.postal_code,country:t.country,phone:t.phone||"",email:t.email||"",is_residential:!0};console.log("Creating from address:",s),console.log("Creating to address:",a);let o=await fetch(`${p}/addresses/`,{method:"POST",headers:{Authorization:`ShippoToken ${c}`,"Content-Type":"application/json"},body:JSON.stringify(s)}),n=await o.json();if(console.log("From address response:",n),!o.ok)throw Error(`Failed to create from address: ${JSON.stringify(n)}`);let l=await fetch(`${p}/addresses/`,{method:"POST",headers:{Authorization:`ShippoToken ${c}`,"Content-Type":"application/json"},body:JSON.stringify(a)}),u=await l.json();if(console.log("To address response:",u),!l.ok)throw Error(`Failed to create to address: ${JSON.stringify(u)}`);let d={address_from:n.object_id,address_to:u.object_id,parcels:r.map(e=>({length:"25",width:"20",height:"5",distance_unit:"cm",weight:"1",mass_unit:"kg"})),async:!1};console.log("Creating shipment:",d);let g=await fetch(`${p}/shipments/`,{method:"POST",headers:{Authorization:`ShippoToken ${c}`,"Content-Type":"application/json"},body:JSON.stringify(d)}),h=await g.json();if(console.log("Shipment response:",h),!g.ok)throw Error(`Failed to create shipment: ${JSON.stringify(h)}`);let m=h.rates.find(e=>"Hermes UK"===e.provider&&"hermes_uk_parcelshop_dropoff"===e.servicelevel.token)||h.rates.find(e=>"Hermes UK"===e.provider);if(!m)throw Error("No Hermes rate found for the shipment");console.log("Selected rate:",m);let k={rate:m.object_id,label_file_type:"PDF",async:!1};console.log("Creating transaction:",k);let y=await fetch(`${p}/transactions/`,{method:"POST",headers:{Authorization:`ShippoToken ${c}`,"Content-Type":"application/json"},body:JSON.stringify(k)});console.log("Shippo API Request:",{url:`${p}/transactions/`,headers:{Authorization:"ShippoToken [REDACTED]","Content-Type":"application/json"},body:k});let f=await y.json();if(console.log("Raw Shippo API Response:",{status:y.status,statusText:y.statusText,headers:Object.fromEntries(y.headers.entries()),data:f}),!y.ok)throw Error(`Failed to create transaction: ${JSON.stringify(f)}`);console.log("Tracking Information Check:",{hasTrackingNumber:!!f.tracking_number,hasTrackingUrl:!!f.tracking_url,hasTrackingStatus:!!f.status,rawTrackingNumber:f.tracking_number,rawTrackingUrl:f.tracking_url,rawStatus:f.status,trackingNumberType:typeof f.tracking_number});let _={success:!0,shipment:h,fromAddress:n,toAddress:u,transaction:{...f,tracking_number:f.tracking_number?String(f.tracking_number):null,tracking_url:f.tracking_url||f.tracking?.url||null,tracking_status:f.status||f.tracking?.status||"pending",estimated_delivery:f.eta||f.tracking?.eta||null,label_url:f.label_url||null},selectedRate:m};return console.log("Final Formatted Response:",{hasTrackingNumber:!!_.transaction.tracking_number,hasTrackingUrl:!!_.transaction.tracking_url,hasTrackingStatus:!!_.transaction.tracking_status,trackingNumber:_.transaction.tracking_number,trackingUrl:_.transaction.tracking_url,trackingStatus:_.transaction.tracking_status,trackingNumberType:typeof _.transaction.tracking_number}),i.NextResponse.json(_)}catch(e){return console.error("Shippo API Error:",e),i.NextResponse.json({error:"Failed to process shipping request",details:e.message,stack:void 0},{status:500})}}let u=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/shippo/route",pathname:"/api/shippo",filename:"route",bundlePath:"app/api/shippo/route"},resolvedPagePath:"/Users/sebastianlourenco/Desktop/CBD/CBD/app/api/shippo/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:d,workUnitAsyncStorage:g,serverHooks:h}=u;function m(){return(0,n.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:g})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[535,38],()=>r(89823));module.exports=s})();